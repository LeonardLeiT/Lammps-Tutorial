### 3. 批量提交任务

基于Linux系统批量提交任务，只是作为反例，需要根据需求灵活调整脚本

---

#### 1. 批量提取的原理
以lammps 拉伸脚本为例，如果我们需要不同温度下的应力应变曲线，那么我们就需要批量运行不同的温度下的lammps脚本。这个工作机械又繁琐，完全可以通过Linux系统批量运行lammps脚本来完成

lammps脚本示例：
```bash
#---------------------------- Atomic setup ------------------------------------#
    # general variables
    variable            Temp equal 200   # 需要从100 K 到 1300 K更换
    print               "T = ${Temp}(K);" 
    # Initalizes the random number generator.
    variable            Random equal 13402  # 随机数也需要更换
    variable            vRandom equal 86622
    # general settings
    units               metal
    atom_style	        atomic
    boundary	        p p p
    # Atom Define
    read_data           Schwarz/schwarz-1-4192.lmp
    mass                *  63.546 
#------------------------------------------------------------------------------#
```

Liunx的 shell脚本统一修改温度和随机数：
```bash
#!/bin/bash
# This script executes sequentially a series of LAMMPS simulations at different temperatures.
# Setup list of parameters to loop over.
T=(100 200 300 400 500 600 700 800 900 1000 1100 1200 1300 1350)

# Create directory structure for data output.
mkdir -p msd 
mkdir -p output
mkdir -p model
mkdir -p data

# 生成随机数
Random=$(shuf -i 1-30000 -n 1)
vRandom=$(shuf -i 1-100000 -n 1)

# 循环计算多个温度
for temperature in "${T[@]}"; do
    # 修改LAMMPS程序中的随机值
    sed -i "s/variable            Random equal .*/variable            Random equal $Random/" in.msd.lmp
    sed -i "s/variable            vRandom equal .*/variable            vRandom equal $vRandom/" in.msd.lmp
    # 修改LAMMPS程序中的温度值
    awk -v temp=$temperature '{sub(/variable            Temp equal .*/, "variable            Temp equal " temp)}1' in.msd.lmp > in.msd_$temperature.lmp
    sed 's|mpirun lmp_mpi .*|mpirun lmp_mpi -i in.msd_'"$temperature"'.lmp|' run.slurm > run_copy.slurm
    # 提交sbatch作业到超算
    sbatch run_copy.slurm
done
```

**注意！！！**

我这个批量修改脚本不仅修改了温度和随机数，同时对应的温度修改还会生成一个新的LAMMPS脚本。这是由于提交的lammps作业会逐行运行，如果中途发生修改很可能造成你的结果不一致，因此每次修改会生一个新的lammps脚本

#### 2. 批量运行lammps作业

将批量修改脚本放在LAMMPS作业文件夹中，并运行
比如 test.sh，是批量修改脚本，需要放在对应LAMMPS作业文件夹

![alt text](Fig/3.1.png)

这样批量处理就需要准备五个文件：
1. **lammps脚本**：比如in.melting.lmp
2. **对应的势函数文件**：比如CuTa_LJ15_2014.adp.txt
3. **提交超算任务的脚本文件**：比如run.slurm
4. **初始的原子构型**（也可以通过lammps代码直接生成，但是复杂结构的构型大部分需要自己提供）：比如HfNbTaTiZr_Hole.
5. **批量修改脚本**：比如 test.sh

运行批量修改脚本：
```bash
cd user/test   # 进入LAMMPS作业文件夹
bash test.sh   # 运行批量修改脚本
```

因为任务提交指令已经写在脚本内容中，所以只需要运行批量修改脚本即可

### 写在最后

现在的AI发达，很多问题可以通过AI来解决，遇到困难问题，尤其是代码问题，可以先求助于AI